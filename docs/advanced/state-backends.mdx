---
title: "State Backends"
description: "Configure remote state storage for team collaboration"
---

# State Backends

State backends persist cldctl state, including datacenter configurations, environment metadata, and infrastructure states. For team collaboration, use a remote backend to share state across machines.

## Supported Backends

| Backend | Description | Use Case |
|---------|-------------|----------|
| `local` | File-based local storage | Development, single-user |
| `s3` | AWS S3 with DynamoDB locking | Teams on AWS |
| `gcs` | Google Cloud Storage | Teams on GCP |
| `azurerm` | Azure Blob Storage | Teams on Azure |

## Configuration

### Local Backend

Default backend for development:

```bash
# Uses default path (~/.cldctl/state/)
cldctl deploy ./my-app -e staging

# Custom path
cldctl deploy ./my-app -e staging \
  --backend local \
  --backend-config path=/custom/state/path
```

### S3 Backend

For AWS-based teams with DynamoDB locking:

```bash
cldctl deploy ./my-app -e staging \
  --backend s3 \
  --backend-config bucket=my-cldctl-state \
  --backend-config region=us-east-1 \
  --backend-config key=cldctl \
  --backend-config dynamodb_table=cldctl-locks
```

**Configuration options:**

| Option | Required | Description |
|--------|----------|-------------|
| `bucket` | Yes | S3 bucket name |
| `region` | No | AWS region (default: from AWS config) |
| `key` | No | Prefix for state files |
| `dynamodb_table` | No | DynamoDB table for locking |
| `encrypt` | No | Enable server-side encryption |

### GCS Backend

For GCP-based teams:

```bash
cldctl deploy ./my-app -e staging \
  --backend gcs \
  --backend-config bucket=my-cldctl-state \
  --backend-config prefix=cldctl
```

**Configuration options:**

| Option | Required | Description |
|--------|----------|-------------|
| `bucket` | Yes | GCS bucket name |
| `prefix` | No | Prefix for state files |
| `project` | No | GCP project (default: from gcloud config) |

### Azure Backend

For Azure-based teams:

```bash
cldctl deploy ./my-app -e staging \
  --backend azurerm \
  --backend-config storage_account_name=myaccount \
  --backend-config container_name=cldctl-state \
  --backend-config key=cldctl
```

**Configuration options:**

| Option | Required | Description |
|--------|----------|-------------|
| `storage_account_name` | Yes | Azure storage account |
| `container_name` | Yes | Blob container name |
| `key` | No | Prefix for state files |

## Environment Variables

Backend configuration can be set via environment variables:

```bash
# S3 Backend
export CLDCTL_BACKEND=s3
export CLDCTL_BACKEND_S3_BUCKET=my-cldctl-state
export CLDCTL_BACKEND_S3_REGION=us-east-1
export CLDCTL_BACKEND_S3_KEY=cldctl

# GCS Backend
export CLDCTL_BACKEND=gcs
export CLDCTL_BACKEND_GCS_BUCKET=my-cldctl-state
export CLDCTL_BACKEND_GCS_PREFIX=cldctl

# Azure Backend
export CLDCTL_BACKEND=azurerm
export CLDCTL_BACKEND_AZURERM_STORAGE_ACCOUNT_NAME=myaccount
export CLDCTL_BACKEND_AZURERM_CONTAINER_NAME=cldctl-state
```

## State Path Structure

Backends store state in a hierarchical structure:

```
<prefix>/
├── datacenters/
│   └── <datacenter-name>/
│       ├── datacenter.state.json
│       ├── modules/
│       │   └── <module>.state.json
│       └── environments/
│           └── <env-name>/
│               ├── environment.state.json
│               ├── modules/
│               │   └── <module>.state.json
│               └── resources/
│                   └── <component>/
│                       └── <resource>.state.json
```

## State Locking

cldctl uses state locking to prevent concurrent modifications. If a lock is held, cldctl shows the lock information:

```
Error: State is locked

  Lock ID:    abc123
  Locked by:  ci-job-456
  Operation:  deploy
  Created:    2026-01-30 14:22:00

Use --force-unlock to break the lock (use with caution).
```

### Force Unlock

In emergencies, force unlock a stuck state:

```bash
cldctl env unlock staging --force
```

<Warning>
Only use force unlock when you're certain no other operation is running. Breaking a lock during an active operation can corrupt state.
</Warning>

## Best Practices

### For Teams

1. **Use a remote backend** - Share state across team members
2. **Enable locking** - Prevent concurrent modifications (S3 with DynamoDB, GCS native)
3. **Secure credentials** - Use IAM roles or service accounts, not static keys
4. **Separate state by environment** - Consider separate backends or prefixes for prod vs dev

### For CI/CD

```yaml
# GitHub Actions example
- name: Deploy to staging
  env:
    CLDCTL_BACKEND: s3
    CLDCTL_BACKEND_S3_BUCKET: ${{ secrets.STATE_BUCKET }}
    CLDCTL_BACKEND_S3_REGION: us-east-1
    CLDCTL_BACKEND_S3_DYNAMODB_TABLE: cldctl-locks
  run: |
    cldctl deploy ghcr.io/myorg/my-app:${{ github.sha }} -e staging --auto-approve
```

## Next Steps

<CardGroup cols={2}>
  <Card title="IaC Plugins" icon="puzzle-piece" href="/advanced/iac-plugins">
    Configure Infrastructure-as-Code plugins
  </Card>
  <Card title="CI/CD Integration" icon="rotate" href="/guides/ci-cd/overview">
    Automate deployments with CI/CD
  </Card>
</CardGroup>
