# =============================================================================
# Questra Environment Configuration
# =============================================================================
# This file is safe to check in to version control. All secrets are resolved
# from OS environment variables or a .env file chain.
#
# Deploy with:
#   arcctl update environment questra examples/environments/questra.yml
#
# Secrets are loaded from (highest priority first):
#   1. --var CLI flags
#   2. OS environment variables (e.g., CLERK_SECRET_KEY)
#   3. .env file chain from CWD (.env, .env.local, .env.questra, .env.questra.local)
#   4. Default values below
# =============================================================================

name: questra

# =============================================================================
# VARIABLES - Resolved from env vars / .env files (never hardcode secrets here)
# =============================================================================
variables:
  # --- Questra app ---
  node_env:
    description: "Node environment"
    default: "development"
  new_user_credits:
    description: "Initial credits for new users"
    default: "2"

  # --- Clerk (Authentication) ---
  clerk_publishable_key:
    description: "Clerk publishable key (pk_test_... or pk_live_...)"
    required: true
  clerk_secret_key:
    description: "Clerk secret key (sk_test_... or sk_live_...)"
    required: true
    sensitive: true
  clerk_encryption_key:
    description: "Clerk encryption key for session tokens"
    sensitive: true
  clerk_webhook_secret:
    description: "Clerk webhook signing secret"
    sensitive: true

  # --- Anthropic (AI) ---
  anthropic_api_key:
    description: "Anthropic API key (sk-ant-...)"
    required: true
    sensitive: true

  # --- Google Vertex AI ---
  google_project_id:
    description: "Google Cloud project ID"
    required: true
    env: GOOGLE_CLOUD_PROJECT
  google_vertex_location:
    description: "Google Cloud region for Vertex AI"
    default: "us-central1"

  # --- Stripe (Payments) ---
  stripe_publishable_key:
    description: "Stripe publishable key (pk_test_... or pk_live_...)"
    required: true
  stripe_secret_key:
    description: "Stripe secret key (sk_test_... or sk_live_...)"
    required: true
    sensitive: true
  stripe_webhook_secret:
    description: "Stripe webhook signing secret (whsec_...)"
    sensitive: true
  stripe_credits_price_base:
    description: "Stripe Price ID for base-tier credits"
  stripe_credits_price_20:
    description: "Stripe Price ID for 20+ credits tier"
  stripe_credits_price_50:
    description: "Stripe Price ID for 50+ credits tier"

  # --- Inngest (Background Jobs) ---
  inngest_event_key:
    description: "Inngest event key for sending events"
    required: true
    sensitive: true
  inngest_signing_key:
    description: "Inngest signing key for verifying webhooks"
    required: true
    sensitive: true

  # --- Slack (Notifications) ---
  slack_bot_token:
    description: "Slack Bot User OAuth Token (xoxb-...)"
    required: true
    sensitive: true
  slack_bot_channel:
    description: "Default Slack channel ID (e.g., C01ABCDEF)"
    required: true

  # --- Apollo.io (Sales Intelligence) ---
  apollo_api_key:
    description: "Apollo.io API key"
    required: true
    sensitive: true
  apollo_app_id:
    description: "Apollo.io tracking snippet app ID"
  apollo_contact_label_names:
    description: "Comma-separated Apollo contact label names"

  # --- Loops (Email Marketing) ---
  loops_api_key:
    description: "Loops API key"
    required: true
    sensitive: true

  # --- Intercom (Customer Messaging) ---
  intercom_app_id:
    description: "Intercom app ID for the Messenger widget"
    required: true
  intercom_secret_key:
    description: "Intercom API secret key"
    required: true
    sensitive: true

  # --- PostHog (Product Analytics) ---
  posthog_key:
    description: "PostHog project API key (phc_...)"
    required: true
  posthog_debug:
    description: "Enable PostHog debug mode"
    default: "false"

# =============================================================================
# COMPONENTS
# =============================================================================
components:
  # ---------------------------------------------------------------------------
  # External Service Dependencies (pass-through components)
  # ---------------------------------------------------------------------------
  questra/clerk:
    source: latest
    variables:
      publishable_key: ${{ variables.clerk_publishable_key }}
      secret_key: ${{ variables.clerk_secret_key }}
      encryption_key: ${{ variables.clerk_encryption_key }}
      webhook_secret: ${{ variables.clerk_webhook_secret }}

  questra/anthropic:
    source: latest
    variables:
      api_key: ${{ variables.anthropic_api_key }}

  questra/google-vertex:
    source: latest
    variables:
      project_id: ${{ variables.google_project_id }}
      location: ${{ variables.google_vertex_location }}

  questra/stripe:
    source: latest
    variables:
      publishable_key: ${{ variables.stripe_publishable_key }}
      secret_key: ${{ variables.stripe_secret_key }}
      webhook_secret: ${{ variables.stripe_webhook_secret }}
      credits_price_base: ${{ variables.stripe_credits_price_base }}
      credits_price_20: ${{ variables.stripe_credits_price_20 }}
      credits_price_50: ${{ variables.stripe_credits_price_50 }}

  questra/inngest:
    source: latest
    variables:
      event_key: ${{ variables.inngest_event_key }}
      signing_key: ${{ variables.inngest_signing_key }}

  questra/slack:
    source: latest
    variables:
      bot_token: ${{ variables.slack_bot_token }}
      bot_channel: ${{ variables.slack_bot_channel }}

  questra/apollo:
    source: latest
    variables:
      api_key: ${{ variables.apollo_api_key }}
      app_id: ${{ variables.apollo_app_id }}
      contact_label_names: ${{ variables.apollo_contact_label_names }}

  questra/loops:
    source: latest
    variables:
      api_key: ${{ variables.loops_api_key }}

  questra/intercom:
    source: latest
    variables:
      app_id: ${{ variables.intercom_app_id }}
      secret_key: ${{ variables.intercom_secret_key }}

  questra/posthog:
    source: latest
    variables:
      key: ${{ variables.posthog_key }}
      debug: ${{ variables.posthog_debug }}

  # ---------------------------------------------------------------------------
  # Questra Application
  # ---------------------------------------------------------------------------
  questra/app:
    source: latest
    variables:
      node_env: ${{ variables.node_env }}
      new_user_credits: ${{ variables.new_user_credits }}
